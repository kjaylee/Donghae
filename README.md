# Donghae

**Donghae**는 각 가정의 Mac을 활용하여 신뢰할 수 있는 뉴럴 엔진(CoreML) 서비스를 제공하는, Zig 기반 블록체인 네트워크입니다.  
"동해(東海)"는 동쪽 바다의 넓고 깊은 이미지를 상징하며, Donghae는 CoreML의 강력한 머신러닝 기능을 분산형으로 제공하여, 확장성과 신뢰성을 확보하는 것을 목표로 합니다.

---

## 목차

- [Donghae](#donghae)
  - [목차](#목차)
  - [1. 프로젝트 개요](#1-프로젝트-개요)
  - [2. 주요 특징](#2-주요-특징)
  - [3. NAT 트래버설 전략](#3-nat-트래버설-전략)
  - [4. 플랫폼 및 CoreML 서비스 통합](#4-플랫폼-및-coreml-서비스-통합)
  - [5. Neural Engine Optimized Consensus with PoS](#5-neural-engine-optimized-consensus-with-pos)
  - [6. 추가 아이디어](#6-추가-아이디어)
  - [7. 활용 오픈 소스](#7-활용-오픈-소스)
  - [8. 테스트 및 배포 전략](#8-테스트-및-배포-전략)
  - [9. 요약](#9-요약)
- [문제 및 해결 방안](#문제-및-해결-방안)
  - [1. Neural Engine Optimized Consensus with PoS](#1-neural-engine-optimized-consensus-with-pos)
    - [문제점](#문제점)
    - [해결 방안 및 방향](#해결-방안-및-방향)
  - [2. NAT 트래버설 전략](#2-nat-트래버설-전략)
    - [문제점](#문제점-1)
    - [해결 방안 및 방향](#해결-방안-및-방향-1)
  - [3. 피어 디스커버리](#3-피어-디스커버리)
    - [문제점](#문제점-2)
    - [해결 방안 및 방향](#해결-방안-및-방향-2)
  - [4. CoreML 서비스 통합](#4-coreml-서비스-통합)
    - [문제점](#문제점-3)
    - [해결 방안 및 방향](#해결-방안-및-방향-3)
  - [5. 전체 시스템 복잡성](#5-전체-시스템-복잡성)
    - [문제점](#문제점-4)
    - [해결 방안 및 방향](#해결-방안-및-방향-4)
  - [결론](#결론)

---

## 1. 프로젝트 개요

Donghae는 집에 있는 Mac을 네트워크에 연결하여, 각 노드가 CoreML 기반 뉴럴 엔진을 실행함으로써 분산형 머신러닝 추론 서비스를 제공하는 블록체인 플랫폼입니다.  
Zig 언어로 구현된 Donghae는 낮은 오버헤드와 높은 성능을 바탕으로, 각 가정의 Mac에서 CoreML 모델을 직접 실행하고, 그 결과를 블록체인에 기록하여 신뢰성과 투명성을 보장합니다.

---

## 2. 주요 특징

1. **Zig 기반 안전하고 효율적인 코드베이스**  
   - Mac 전용 환경에 최적화된 코드를 제공하며, 강력한 컴파일 타임 검증으로 메모리 안전성과 신뢰성을 확보합니다.

2. **QUIC 프로토콜을 통한 네트워크 통신 최적화**  
   - 빠른 연결 수립과 낮은 지연 시간, 내장 TLS 1.3 암호화를 통해 보안성이 강화된 통신을 지원합니다.

3. **PoH (Proof of History)를 통한 시간 순서 증명**  
   - 블록 생성 시간과 순서를 암호학적으로 증명하여, 블록체인의 무결성을 유지합니다.

4. **Neural Engine Optimized Consensus with PoS**  
   - 각 노드는 CoreML 추론 결과와 함께 관련 증명(서명, 해시 등)을 제출하여, 결과의 신뢰성을 빠르게 검증합니다.
   - PoS(Proof of Stake) 메커니즘을 도입하여 노드가 일정량의 스테이크를 걸고, 정확하고 신속한 추론 결과를 제공하는 노드에 인센티브를 부여합니다.
   - 작업은 동적 병렬 처리로 분산되어, 빠른 노드는 더 많은 작업을 처리하고, 느린 노드도 자신의 속도에 맞게 기여할 수 있도록 최적화됩니다.

5. **자동 NAT 트래버설**  
   - **NAT-PMP 우선:**  
     - 간단한 프로토콜 구조와 낮은 메시지 오버헤드로 빠른 포트 매핑 설정이 가능하며, macOS 등 애플 생태계에서 높은 신뢰성을 제공합니다.
   - **UPnP 페일오버:**  
     - NAT-PMP가 지원되지 않거나 실패할 경우, 대부분의 소비자용 라우터에서 UPnP를 통해 포트 매핑을 재시도합니다.
   - 검증된 Transmission의 전략을 채택하여 전체 성공률과 안정성을 극대화합니다.

6. **피어 디스커버리**  
   - UDP 기반의 announce 메시지 교환을 통해 중앙 서버 없이 동적 피어 검색 및 네트워크 상태 갱신을 지원합니다.

7. **플랫폼 및 CoreML 서비스 통합**  
   - Mac 환경에 최적화되어 각 가정의 Mac에서 CoreML 모델을 직접 실행, 머신러닝 추론 서비스를 제공하고 그 결과를 블록체인에 기록합니다.

---

## 3. NAT 트래버설 전략

Donghae는 외부 피어가 집에 있는 Mac 내부의 CoreML 서비스에 접근할 수 있도록, 자동 포트 매핑 모듈을 통해 NAT 트래버설을 지원합니다.

- **NAT-PMP 우선 사용:**  
  - 간단한 프로토콜 구조와 낮은 메시지 오버헤드로 빠른 포트 매핑 설정을 제공  
  - macOS 및 애플 생태계에서 기본 활성화되어 높은 신뢰성을 보장

- **UPnP 페일오버:**  
  - NAT-PMP 방식이 지원되지 않거나 실패할 경우, UPnP를 통해 포트 매핑을 재시도하여 전체 성공률을 극대화

- **Transmission 전략 채택:**  
  - 검증된 NAT-PMP 우선, UPnP 페일오버 방식을 통해 외부 피어가 내부 Mac의 CoreML 서비스에 접근할 수 있도록 보장

---

## 4. 플랫폼 및 CoreML 서비스 통합

Donghae는 Mac 플랫폼에 최적화되어 있으며, CoreML 기반 뉴럴 엔진 서비스를 다음과 같이 제공합니다:

- **CoreML 통합:**  
  - 각 노드는 내장된 CoreML 뉴럴 엔진을 이용해 머신러닝 추론 작업을 수행  
  - 추론 결과는 블록체인에 기록되어 분산형 데이터 분석 및 dApp 서비스에 활용됩니다.

- **Mac 전용 최적화:**  
  - Mac 하드웨어(특히 Apple Silicon)와 소프트웨어의 강점을 최대한 활용하여, 효율적이고 안정적인 서비스 환경을 구축  
  - 사용자 인터페이스 및 네트워크 설정은 Mac 환경에 최적화되어 제공됩니다.

---

## 5. Neural Engine Optimized Consensus with PoS

Donghae의 합의 알고리즘은 CoreML 추론 결과의 정확성과 제출 속도뿐 아니라, 각 노드의 스테이크를 기반으로 하는 PoS 메커니즘을 도입하여 신뢰성과 경제적 인센티브를 제공합니다.

- **추론 결과 증명:**  
  - 각 노드는 CoreML 추론 결과와 함께 디지털 서명, 해시 등의 증명을 제출하여 결과의 신뢰성을 검증합니다.

- **PoS 기반 인센티브:**  
  - 노드들은 일정량의 스테이크를 걸고, 정확하고 신속한 추론 결과를 제출하면 보상을 받습니다.
  - 이를 통해 성능 차이로 인한 소외를 방지하고, 모든 노드가 공정하게 참여할 수 있는 환경을 조성합니다.

- **동적 작업 스케줄링:**  
  - 작업 큐와 병렬 처리 시스템을 도입하여, 빠른 노드는 더 많은 작업을, 느린 노드는 자신의 속도에 맞게 작업을 수행하도록 하여 전체 처리량을 극대화합니다.

- **낮은 지연 및 높은 처리량:**  
  - 최적화된 합의 프로세스는 머신러닝 추론의 결과를 신속하게 통합하고, 블록체인 상태를 효율적으로 업데이트합니다.

---

## 6. 추가 아이디어

Donghae 프로젝트는 CoreML 서비스와 블록체인 네트워크의 확장성을 강화하기 위해 다음과 같은 추가 아이디어를 고려합니다:

- **스마트 컨트랙트를 통한 CoreML 모델 업데이트 및 배포:**  
  - 분산형 스마트 컨트랙트를 사용해 최신 CoreML 모델의 자동 업데이트와 버전 관리를 수행

- **토큰화 및 인센티브 메커니즘:**  
  - 노드가 CoreML 추론 서비스를 제공할 때 토큰 보상 및 인센티브를 지급하여, 경제적 동기를 강화

- **연합 학습 지원:**  
  - 각 Mac에서 학습한 모델 파라미터를 분산 방식으로 집계하여, 중앙 서버 없이 모델을 업데이트

- **에지 컴퓨팅 통합:**  
  - 각 노드를 에지 컴퓨팅 리소스로 활용해 지역별로 빠른 응답과 낮은 지연을 보장

- **고급 모니터링 및 관리 대시보드:**  
  - 각 노드의 CoreML 성능, 네트워크 상태, 자원 사용률 등을 실시간 모니터링하여 운영자가 빠르게 대응할 수 있도록 지원

- **분산 ID 및 인증 체계 (DID):**  
  - 탈중앙화된 ID 시스템을 도입하여 노드의 신뢰성과 보안을 강화

- **컨테이너 및 오케스트레이션 지원:**  
  - Docker, Kubernetes 등을 도입해 각 Mac 노드의 소프트웨어 배포 및 관리를 자동화

- **모듈식 전송 프로토콜 지원:**  
  - 향후 필요에 따라 QUIC와 같은 최신 전송 프로토콜을 도입하여, 네트워크 성능과 보안성을 상황에 맞게 조정

- **분산 데이터 스토리지 및 상태 관리 강화:**  
  - IPFS, Filecoin 등과 연계하여 대용량 데이터의 분산 저장과 효율적 상태 관리를 구현

---

## 7. 활용 오픈 소스

Donghae 프로젝트는 다음의 주요 오픈 소스 기술들을 활용합니다:

- **[Zig Language & Zig Standard Library](https://github.com/ziglang/zig)**  
  - Mac 전용 개발 환경에서 네트워크 인터페이스 열거, UDP 통신, 스레드, 메모리 관리 및 유닛 테스트 기능 제공

- **[miniupnpc](http://miniupnp.free.fr/)**  
  - UPnP 프로토콜을 통해 라우터 검색 및 포트 매핑 설정/해제를 지원  
  - [miniupnpc GitHub mirror](https://github.com/miniupnp/miniupnp)

- **[libnatpmp](https://miniupnp.tuxfamily.org/libnatpmp.html)**  
  - NAT-PMP 프로토콜을 통해 UPnP 방식이 실패할 경우 대체 수단으로 포트 매핑 지원  
  - [libnatpmp GitHub mirror](https://github.com/miniupnp/libnatpmp)

---

## 8. 테스트 및 배포 전략

- **유닛 테스트:**  
  - Zig의 내장 테스트 프레임워크를 활용하여 내부 IP 탐지, NAT 트래버설, 피어 디스커버리, 그리고 합의 관련 기능을 철저히 검증합니다.

- **배포:**  
  - 빌드 스크립트(`build.zig`)를 통해 전체 프로젝트를 컴파일 및 패키징  
  - 운영 환경에서는 Mac 전용 데몬 또는 백그라운드 프로세스로 실행되며, 로그 및 모니터링 시스템을 통해 안정적인 운영을 보장합니다.

---

## 9. 요약

Donghae는 각 가정의 Mac을 활용하여 CoreML 기반 뉴럴 엔진 서비스를 신뢰할 수 있게 제공하는 블록체인 플랫폼입니다.  
주요 기능은 다음과 같습니다:

- **안전하고 효율적인 Zig 기반 코드베이스:**  
  Mac 전용 환경에 최적화되어 높은 성능과 안정성을 제공합니다.

- **최적화된 네트워크 통신:**  
  QUIC 프로토콜을 통한 빠른 연결 및 암호화된 통신으로, 분산 네트워크에서 안정적인 데이터 전송을 지원합니다.

- **시간 순서 증명:**  
  PoH를 통해 블록 생성 시간 및 순서의 무결성을 보장합니다.

- **Neural Engine Optimized Consensus with PoS:**  
  각 노드가 CoreML 추론 결과와 함께 증명 정보를 제출하며, PoS 기반 인센티브를 통해 정확하고 신속한 결과를 보상받아, 효율적인 합의를 도출합니다.

- **자동 NAT 트래버설:**  
  NAT-PMP 우선, UPnP 페일오버 전략을 채택하여 외부 피어가 내부 Mac의 CoreML 서비스에 안전하게 접근할 수 있도록 포트 매핑을 자동 설정합니다.

- **피어 디스커버리:**  
  UDP 기반의 announce 메시지 교환을 통해 중앙 서버 없이 동적 피어 검색 및 네트워크 상태 갱신을 지원합니다.

- **플랫폼 및 CoreML 서비스 통합:**  
  Mac 하드웨어와 소프트웨어를 최대한 활용하여, 각 가정의 Mac에서 CoreML 모델을 실행, 분산형 머신러닝 추론 서비스를 제공하며 그 결과를 블록체인에 기록합니다.

Donghae는 이러한 통합된 기술과 추가 아이디어들을 바탕으로, 집에 있는 Mac을 활용하여 신뢰할 수 있는 CoreML 서비스를 제공하는 글로벌 블록체인 플랫폼으로 발전할 것을 목표로 합니다.


# 문제 및 해결 방안

동해 프로젝트의 주요 구현 및 운영 단계에서 예상되는 문제점들과, 각 문제에 대한 해결책 및 방향을 아래와 같이 정리할 수 있습니다.

---

## 1. Neural Engine Optimized Consensus with PoS

### 문제점
- **합의 알고리즘 설계 복잡성:**  
  CoreML 추론 결과와 함께 제출되는 증명(서명, 해시 등)을 이용해 합의를 도출하는 새로운 방식은 기존 합의 알고리즘(PoW, PoS)과 차별화되며, 설계와 검증이 복잡합니다.
- **경제적 인센티브 부재:**  
  PoS 메커니즘이 없다면, 노드들의 행동에 대한 경제적 동기 부여가 어려워 악의적인 행위나 불성실한 추론 결과 제출 위험이 있습니다.
- **성능 불균형:**  
  노드 간 하드웨어 성능 및 네트워크 환경의 차이로 인해, 빠른 노드와 느린 노드 간에 불공평한 결과 평가가 이루어질 수 있습니다.

### 해결 방안 및 방향
- **하이브리드 합의 설계:**  
  - 기존의 PoS 메커니즘을 기본 틀로 사용하고, CoreML 추론 결과의 정확성과 제출 속도, 그리고 디지털 증명을 결합한 평가 모듈을 추가합니다.
  - 초기에 단순한 PoS 기반 합의를 구현한 후, 점진적으로 추론 결과 평가 모듈을 통합하는 단계적 접근법을 적용합니다.
- **경제적 인센티브 체계 도입:**  
  - 노드들이 일정량의 스테이크를 걸고, 올바른 추론 결과 제출 시 보상하는 경제 모델을 설계합니다.
  - 성능에 따른 가중치를 부여하되, 상대적으로 성능이 낮은 노드도 일정 기준 이상의 기여를 할 경우 보상을 받을 수 있도록 보정 메커니즘을 도입합니다.
- **프로토타입 및 시뮬레이션:**  
  - 작은 테스트넷에서 여러 노드의 추론 결과를 모니터링하고, 합의 과정의 동작 및 인센티브 효과를 시뮬레이션하여, 문제점을 조기에 파악하고 개선합니다.

---

## 2. NAT 트래버설 전략

### 문제점
- **라우터 및 네트워크 환경 다양성:**  
  가정용 라우터마다 NAT-PMP와 UPnP 지원 수준이 다르며, 일부 환경에서는 두 프로토콜 모두 제대로 작동하지 않을 수 있습니다.
- **오류 처리 및 페일오버:**  
  NAT-PMP 방식이 실패할 경우 UPnP로 자동 전환하는 전략이 모든 상황에서 안정적으로 동작할지에 대한 검증이 필요합니다.

### 해결 방안 및 방향
- **강력한 오류 처리 및 로깅:**  
  - miniupnpc와 libnatpmp를 모두 통합한 모듈에 대해 다양한 네트워크 환경에서 발생할 수 있는 오류를 세밀하게 처리하고, 로그를 남겨 문제 상황을 분석할 수 있도록 합니다.
- **동적 페일오버 로직 개선:**  
  - NAT-PMP 시도가 실패할 경우, UPnP로 전환하는 로직에 재시도 및 타임아웃 조정 기능을 추가합니다.
  - 사용자 설정이나 자동 환경 감지를 통해, 특정 라우터에서는 수동으로 모드를 선택할 수 있는 옵션을 제공할 수 있습니다.
- **광범위한 테스트:**  
  - 실제 다양한 가정용 라우터와 NAT 환경에서 테스트하여, 예외 상황 및 문제를 미리 파악하고 보완합니다.

---

## 3. 피어 디스커버리

### 문제점
- **UDP 브로드캐스트 제한:**  
  일부 NAT나 방화벽 환경에서는 UDP 브로드캐스트가 제한될 수 있어 피어 검색에 제약이 있을 수 있습니다.
- **신뢰성과 확장성:**  
  단순 announce 메시지 방식만으로는 피어 테이블의 신뢰성과 확장성을 보장하기 어려울 수 있습니다.

### 해결 방안 및 방향
- **보완 프로토콜 도입:**  
  - 기본 UDP announce 외에도, DHT(분산 해시 테이블) 기반 피어 검색 또는 피어 교환(PEX) 프로토콜을 통합하여, 중앙 서버 없이도 안정적인 피어 디스커버리를 구현합니다.
- **재시도 및 중복 제거 메커니즘:**  
  - 중복된 메시지 처리, 타임아웃, 재시도 로직을 추가하여, 네트워크 환경에 관계없이 일관된 피어 정보를 유지합니다.
- **환경별 설정 옵션 제공:**  
  - 사용자가 자신의 네트워크 환경에 맞게 피어 디스커버리 설정(브로드캐스트 주기, 타임아웃 등)을 조정할 수 있도록 합니다.

---

## 4. CoreML 서비스 통합

### 문제점
- **하드웨어 성능 차이:**  
  각 가정의 Mac은 하드웨어 사양과 네트워크 환경이 다르므로, CoreML 추론 결과의 처리 속도와 정확성에 편차가 발생할 수 있습니다.
- **서비스 품질 보장:**  
  최신 모델 업데이트, 버전 관리, 그리고 추론 결과의 신뢰성 검증 등이 필요하며, 노드 간 성능 불균형이 서비스 품질에 영향을 줄 수 있습니다.

### 해결 방안 및 방향
- **동적 작업 스케줄링:**  
  - 작업 큐와 병렬 처리 시스템을 도입하여, 빠른 노드는 더 많은 작업을, 느린 노드는 자신의 속도에 맞게 작업을 처리할 수 있도록 합니다.
- **성능 보정 및 모니터링:**  
  - 각 노드의 CoreML 추론 성능을 주기적으로 벤치마크하고, 결과를 보정하는 알고리즘을 개발합니다.
  - 실시간 모니터링 도구를 통해 각 노드의 성능과 품질을 지속적으로 점검하고, 문제가 발생할 경우 자동 조정을 시도합니다.
- **모델 업데이트 및 버전 관리:**  
  - 스마트 컨트랙트나 별도의 관리 시스템을 통해 CoreML 모델의 업데이트와 버전 관리를 자동화하여, 네트워크 전반에서 최신 모델을 사용할 수 있도록 합니다.

---

## 5. 전체 시스템 복잡성

### 문제점
- **모듈 간 통합 어려움:**  
  여러 기술(네트워크 통신, 합의, NAT 트래버설, 피어 디스커버리, CoreML 서비스)을 하나의 시스템에 통합하는 것은 인터페이스와 데이터 흐름을 명확히 정의하고 유지하는 데 어려움이 있습니다.
- **확장 및 유지보수:**  
  복잡한 시스템은 향후 확장이나 업데이트, 유지보수가 어려워질 수 있습니다.

### 해결 방안 및 방향
- **모듈식 설계와 명확한 인터페이스:**  
  - 각 기능(내부 IP 탐지, NAT 트래버설, 피어 디스커버리, 합의, CoreML 서비스)을 별도의 모듈로 분리하고, 표준화된 API를 통해 상호 연동합니다.
- **점진적 통합 및 테스트:**  
  - 각 모듈을 독립적으로 개발 및 테스트한 후, 점진적으로 통합하여 전체 시스템의 안정성을 확보합니다.
- **지속적인 문서화 및 CI/CD 도입:**  
  - 모듈 간 인터페이스, 데이터 흐름, 및 운영 시나리오를 자세히 문서화하고, 지속적인 통합/배포(CI/CD) 시스템을 도입하여 변경 사항을 신속하게 반영합니다.

---

## 결론

Donghae 프로젝트는 혁신적인 CoreML 서비스 제공을 목표로 하는 Mac 전용 블록체인 플랫폼입니다.  
각 주요 기능에 대해 아래와 같은 해결 방안을 적용할 계획입니다:

- **Neural Engine Optimized Consensus with PoS:**  
  PoS 메커니즘을 도입하여 경제적 인센티브와 스테이크 기반 보상을 통해 노드들이 정확하고 신속한 CoreML 추론 결과를 제출하도록 유도하며, 디지털 증명과 동적 작업 스케줄링을 통해 성능 불균형 문제를 완화합니다.

- **NAT 트래버설:**  
  다양한 가정용 라우터 환경을 고려하여 NAT-PMP 우선, UPnP 페일오버 전략을 구현하고, 강력한 오류 처리와 재시도 로직으로 안정성을 확보합니다.

- **피어 디스커버리:**  
  UDP 기반의 announce 메시지와 보완 프로토콜(DHT, PEX 등)을 통합하여, 네트워크 환경에 관계없이 동적 피어 검색 및 네트워크 상태 갱신을 보장합니다.

- **CoreML 서비스 통합:**  
  각 Mac의 CoreML 성능을 동적으로 조정하고, 작업 분배를 최적화하는 병렬 처리 시스템과 모니터링 도구를 도입하여, 서비스 품질과 일관성을 유지합니다.

- **전체 시스템 복잡성 관리:**  
  모듈식 설계, 명확한 인터페이스 정의, 그리고 지속적인 테스트와 문서화를 통해, 복잡한 시스템의 통합과 확장을 용이하게 합니다.

이러한 해결 방안들을 통해, Donghae는 각 가정의 Mac을 활용하여 신뢰할 수 있는 CoreML 기반 서비스를 제공하는 동시에, 확장 가능하고 안정적인 블록체인 네트워크로 발전할 수 있을 것입니다.
